<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Learn Python ‚Äî Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="page-header">
    <div class="header-inner">
      <div class="brand">
        <h1>üêç Learn Python</h1>
        <p class="lead">Interactive lessons, quizzes, and a live playground</p>
      </div>

      <div style="display:flex;align-items:center;gap:12px;">
        <nav class="mini-nav" aria-label="Main navigation">
          <a href="lessons.html" class="mini-nav-link">Lessons</a>
          <a href="questions.html" class="mini-nav-link">Quizzes</a>
          <a href="dashboard.html" class="mini-nav-link">Dashboard</a>
          <a href="playground.html" class="mini-nav-link">Playground</a>
        </nav>

        <div id="profileWidget"></div>
      </div>
    </div>
  </header>

  <main class="container center">
    <h2>Welcome ‚Äî learn Python step-by-step</h2>
    <p class="small">Start with Beginner lessons and progress to Expert topics with quizzes & a live playground.</p>

    <div style="margin-top:18px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
      <a class="btn" href="lessons.html">Browse Lessons</a>
      <a class="btn secondary" href="questions.html">Take a Quiz</a>
      <a class="btn ghost" href="dashboard.html">View Dashboard</a>
    </div>

    <div id="home-stats" style="margin-top:26px; display:flex; gap:12px; justify-content:center; flex-wrap:wrap;"></div>
  </main>

  <footer>
    <div class="container center small">¬© 2025 Learn Python ‚Äî local client-side demo</div>
  </footer>

  <script src="app.js"></script>
  <script>
    (async function () {
      // Render profile in header
      window.learnApp.renderHeaderProfile('#profileWidget');

      // Show small snapshot (per-user)
      const profile = window.learnApp.getCurrentProfile();
      const userId = profile && profile.id ? profile.id : 'user_guest';

      try {
        const res = await fetch('lessons.json');
        const lessons = await res.json();
        const total = lessons.length;
        const progress = window.learnApp.getUserProgress(userId);
        const completed = Object.values(progress).filter(v => v === true).length;

        const quizStats = window.learnApp.getUserQuizStats(userId);
        let totalAttempts = 0, avgAcross = 0, categories = 0;
        for (const k in quizStats) {
          totalAttempts += (quizStats[k].attempts || 0);
          if ((quizStats[k].scores || []).length) {
            const s = quizStats[k].scores.reduce((a,b) => a+b,0) / quizStats[k].scores.length;
            avgAcross += s; categories++;
          }
        }
        const avgScore = categories ? Math.round(avgAcross / categories) : 0;

        const homeStats = document.getElementById('home-stats');
        homeStats.innerHTML = `
          <div class="card" style="min-width:160px">
            <h4 style="margin:6px 0">Lessons</h4>
            <p class="small">${completed} / ${total} completed</p>
          </div>
          <div class="card" style="min-width:160px">
            <h4 style="margin:6px 0">Quiz Attempts</h4>
            <p class="small">${totalAttempts} attempts</p>
          </div>
          <div class="card" style="min-width:160px">
            <h4 style="margin:6px 0">Avg Score</h4>
            <p class="small">${avgScore}%</p>
          </div>
        `;
      } catch (e) {
        console.error('Home stats failed', e);
      }
    })();
  </script>
</body>
</html>
