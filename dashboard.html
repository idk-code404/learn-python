<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard â€” Learn Python</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .dashboard-grid { max-width:1200px; margin:18px auto; padding:0 16px; display:grid; grid-template-columns: 1fr 360px; gap:18px; }
    .left, .right { background:var(--card-bg); padding:16px; border-radius:10px; box-shadow: 0 6px 16px rgba(0,0,0,0.04); }
    .lessons-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap:12px; }
    .lesson-card { padding:12px; border-radius:8px; border:1px solid rgba(0,0,0,0.04); background:#fff; }
    .controls { display:flex; gap:8px; justify-content:flex-end; margin-bottom:10px; }
    @media (max-width:900px) { .dashboard-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header class="page-header">
    <div class="header-inner">
      <div class="brand">
        <h1>ðŸ“Š Progress Dashboard</h1>
        <p class="lead">See lesson progress and quiz performance</p>
      </div>
      <nav class="mini-nav" aria-label="Main navigation">
        <a href="lessons.html" class="mini-nav-link">Lessons</a>
        <a href="questions.html" class="mini-nav-link">Quizzes</a>
        <a href="dashboard.html" class="mini-nav-link" aria-current="page">Dashboard</a>
        <a href="playground.html" class="mini-nav-link">Playground</a>
      </nav>
    </div>
  </header>

  <main class="dashboard-grid">
    <section class="left">
      <div class="controls">
        <button id="resetProgressBtn" class="btn">Reset Progress</button>
        <button id="resetQuizBtn" class="btn">Reset Quiz Stats</button>
      </div>

      <h2>Lessons</h2>
      <div id="lessonsContainer" class="lessons-grid" aria-live="polite">
        <!-- lesson cards -->
      </div>
    </section>

    <aside class="right" aria-labelledby="stats-heading">
      <h3 id="stats-heading">Summary</h3>
      <div id="summaryArea">
        <!-- stats render here -->
      </div>
      <hr style="margin:12px 0">
      <h4>Quiz Breakdown</h4>
      <div id="quizBreakdown"></div>
    </aside>
  </main>

  <script>
    // Utility: read lessons.json and render dashboard
    async function loadLessons() {
      const res = await fetch('lessons.json');
      return res.json();
    }

    function getProgress() {
      return JSON.parse(localStorage.getItem('progress')) || {};
    }

    function getQuizStats() {
      return JSON.parse(localStorage.getItem('quizStats')) || {};
    }

    function saveProgress(progress) {
      localStorage.setItem('progress', JSON.stringify(progress));
    }

    function saveQuizStats(stats) {
      localStorage.setItem('quizStats', JSON.stringify(stats));
    }

    (async function init() {
      const lessons = await loadLessons();
      const container = document.getElementById('lessonsContainer');
      const progress = getProgress();
      container.innerHTML = '';
      lessons.forEach(l => {
        const card = document.createElement('div');
        card.className = 'lesson-card';
        const done = !!progress[l.id];
        card.innerHTML = `
          <h4 style="margin:4px 0">${l.title}</h4>
          <p class="small" style="margin:6px 0;color:var(--muted)">${l.category}</p>
          <p style="margin:6px 0">${done ? 'âœ… Completed' : 'âšª Not completed'}</p>
          <div style="display:flex;gap:8px;justify-content:flex-end;">
            <a class="btn" href="lessons.html#lesson-${l.id}">Open</a>
          </div>
        `;
        container.appendChild(card);
      });

      // Summary area
      const total = lessons.length;
      const progressObj = getProgress();
      const completedCount = Object.values(progressObj).filter(v => v === true).length;
      const summary = document.getElementById('summaryArea');
      summary.innerHTML = `
        <p><strong>${completedCount}</strong> / ${total} lessons completed</p>
        <div class="progress-bar" style="margin-bottom:10px;"><div class="progress-fill" style="width:${Math.round((completedCount/total)*100)}%"></div></div>
      `;

      // Quiz breakdown
      const quizStats = getQuizStats();
      const breakdown = document.getElementById('quizBreakdown');
      if (Object.keys(quizStats).length === 0) {
        breakdown.innerHTML = '<p class="small">No quiz data yet â€” take a quiz to begin.</p>';
      } else {
        let html = '';
        for (const cat of Object.keys(quizStats)) {
          const data = quizStats[cat];
          const avg = data.scores.length ? Math.round(data.scores.reduce((a,b)=>a+b,0)/data.scores.length) : 0;
          const best = data.scores.length ? Math.max(...data.scores) : 0;
          html += `<div style="margin-bottom:10px"><strong>${cat}</strong><div class="small">Attempts: ${data.attempts} â€¢ Avg: ${avg}% â€¢ Best: ${best}%</div></div>`;
        }
        breakdown.innerHTML = html;
      }

      // Reset handlers
      document.getElementById('resetProgressBtn').addEventListener('click', () => {
        if (!confirm('Reset lesson progress? This cannot be undone.')) return;
        localStorage.removeItem('progress');
        location.reload();
      });
      document.getElementById('resetQuizBtn').addEventListener('click', () => {
        if (!confirm('Reset quiz stats? This will erase saved attempts.')) return;
        localStorage.removeItem('quizStats');
        location.reload();
      });
    })();
  </script>
</body>
</html>
