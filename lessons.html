<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Python Lessons</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>üêç Python Lessons</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="playground.html">Playground</a>
      <a href="questions.html">Questions</a>
    </nav>
  </header>

  <aside id="toc">
    <h3>üìö Table of Contents</h3>
    <ul id="tocList"></ul>
    <div id="tips">
      <h4>üí° Python Tips</h4>
      <ul>
        <li>Use descriptive variable names.</li>
        <li>Indentation matters in Python ‚Äî use 4 spaces.</li>
        <li>Use `try/except` to handle errors safely.</li>
        <li>Experiment with code to truly understand it.</li>
      </ul>
    </div>
  </aside>

  <main id="lessonContainer"></main>

  <script>
    async function loadLessons() {
      const res = await fetch('lessons.json');
      const lessons = await res.json();

      const container = document.getElementById('lessonContainer');
      const tocList = document.getElementById('tocList');

      let categories = {};
      lessons.forEach(l => {
        if (!categories[l.category]) categories[l.category] = [];
        categories[l.category].push(l);
      });

      for (const cat of Object.keys(categories)) {
        const section = document.createElement('section');
        section.id = cat.toLowerCase();
        section.innerHTML = `<h2>${cat}</h2>`;
        container.appendChild(section);

        const catLink = document.createElement('li');
        catLink.innerHTML = `<a href="#${cat.toLowerCase()}">${cat}</a>`;
        tocList.appendChild(catLink);

        categories[cat].forEach(lesson => {
          const div = document.createElement('div');
          div.classList.add('lesson');
          div.innerHTML = `
            <h3>${lesson.title}</h3>
            <p>${lesson.content}</p>
            <pre><code>${lesson.code}</code></pre>
            <button class="try-btn" onclick="tryCode('${encodeURIComponent(lesson.code)}')">‚ñ∂ Try Code</button>
            <button class="quiz-btn" onclick="takeQuiz('${lesson.id}')">Take Quiz</button>
          `;
          section.appendChild(div);
        });
      }

      // Sticky TOC highlight
      window.addEventListener('scroll', () => {
        const sections = document.querySelectorAll('main section');
        let scrollPos = document.documentElement.scrollTop || document.body.scrollTop;
        sections.forEach(sec => {
          const top = sec.offsetTop - 120;
          const bottom = top + sec.offsetHeight;
          const link = document.querySelector(`#toc a[href="#${sec.id}"]`);
          if (scrollPos >= top && scrollPos < bottom) {
            document.querySelectorAll('#toc a').forEach(a => a.classList.remove('active'));
            link.classList.add('active');
          }
        });
      });
    }

    function tryCode(encodedCode) {
      const code = decodeURIComponent(encodedCode);
      navigator.clipboard.writeText(code);
      window.open('playground.html', '_blank');
    }

    async function takeQuiz(id) {
      const res = await fetch('lessons.json');
      const lessons = await res.json();
      const lesson = lessons.find(l => l.id == id);
      if (!lesson.quiz) return alert('No quiz for this lesson.');

      const userAns = prompt(lesson.quiz.question + '\n\n' + lesson.quiz.options.join('\n'));
      if (userAns === lesson.quiz.answer) {
        alert('‚úÖ Correct!');
        const progress = JSON.parse(localStorage.getItem('progress')) || {};
        progress[id] = true;
        localStorage.setItem('progress', JSON.stringify(progress));
      } else {
        alert('‚ùå Incorrect. Correct answer: ' + lesson.quiz.answer);
      }
    }

    loadLessons();
  </script>
</body>
</html>
